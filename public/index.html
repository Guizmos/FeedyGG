<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>FeedYGG</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="favicon.png" />
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="app">
    <header class="app-header">
      <div class="logo">
        <span class="logo-main">YGG</span>
        <span class="logo-sub">Feed</span>
      </div>

      <div class="controls">
        <div id="filters-container" class="filters-container">
          <button id="search-toggle" class="controls-search-btn" title="Recherche">
            <span class="icon-glyph material-symbols-rounded">search</span>
          </button>

          <label>
            Catégorie:
            <select id="category-select" class="pill-select"></select>
          </label>

          <label>
            Résultats:
            <select id="limit-select" class="pill-select">
              <option value="3" selected>3</option>
              <option value="9">9</option>
              <option value="all">Tout</option>
            </select>
          </label>

          <label>
            Tri:
            <select id="sort-select" class="pill-select">
              <option value="seeders" selected>Seeders</option>
              <option value="date">Date d'ajout</option>
              <option value="name">Nom</option>
            </select>
          </label>
        </div>

        <div id="search-container" class="search-container hidden">
          <button id="filters-mini" class="filters-mini" title="Filtres">
            <span class="icon-glyph material-symbols-rounded">tune</span>
          </button>

          <div class="search-input-shell">
            <span class="search-icon icon-glyph material-symbols-rounded">search</span>
            <input
              id="search-input"
              class="search-input"
              type="text"
              placeholder="Rechercher dans les résultats…"
              autocomplete="off"
            />
            <button id="search-clear" class="search-clear-btn" type="button">
              <span class="icon-glyph material-symbols-rounded">close</span>
            </button>
          </div>
        </div>
      </div>

      <div class="header-actions">
        <div class="header-actions-group">
          <button id="refresh-btn" class="header-btn" title="Rafraîchir">
            <span class="icon-glyph material-symbols-rounded">refresh</span>
          </button>
          <button id="settings-btn" class="header-btn" title="Paramètres">
            <span class="icon-glyph material-symbols-rounded">settings</span>
          </button>
        </div>
      </div>
    </header>

    <main class="app-main">
      <div class="stats-bar">
        <div id="stats" class="stats"></div>
        <div id="active-date-filter-chip" class="date-filter-chip hidden"></div>
        <div id="date-filter-panel" class="date-filter-panel hidden"></div>
        <button id="date-filter-btn" class="header-btn date-filter-btn">
          <span class="material-symbols-rounded">filter_alt</span>
        </button>
        <button
          id="sort-direction-btn"
          class="header-btn sort-direction-btn"
          type="button"
          title="Inverser l'ordre du tri">
          <span class="material-symbols-rounded sort-rotate-icon">sync_alt</span>
        </button>
      </div>

      <div id="loading" class="loading hidden">
      </div>
      <div id="error" class="error hidden"></div>
      <div id="empty" class="empty hidden">Aucun résultat.</div>
      <div id="cards"></div>
    </main>

    <footer id="app-footer" class="app-footer">
      <div class="footer-inner">
        <span class="footer-logo">
          <span class="logo-main">YGG</span>
          <span class="logo-sub">Feed</span>
        </span>
        <span class="footer-separator">•</span>
        <span class="footer-text">Tous droits réservés</span>
        <span id="app-version" class="footer-version">v0.0.0</span>
      </div>
    </footer>
  </div>

  <div id="settings-overlay" class="settings-overlay hidden"></div>
  <div id="settings-modal" class="settings-modal hidden">
    <h2>Paramètres</h2>

    <div class="settings-layout">
      <nav class="settings-sidebar">
        <button class="settings-nav-item active" data-section="theme">
          <span class="settings-nav-icon material-symbols-rounded">dark_mode</span>
          <div class="settings-nav-text">
            <span class="settings-nav-label">Apparence</span>
            <span class="settings-nav-sub">Thème de l’interface</span>
          </div>
        </button>

        <button class="settings-nav-item" data-section="sort">
          <span class="settings-nav-icon material-symbols-rounded">sort</span>
          <div class="settings-nav-text">
            <span class="settings-nav-label">Tri par défaut</span>
            <span class="settings-nav-sub">Ordre du flux</span>
          </div>
        </button>

        <button class="settings-nav-item" data-section="date">
          <span class="settings-nav-icon material-symbols-rounded">schedule</span>
          <div class="settings-nav-text">
            <span class="settings-nav-label">Filtre par défaut</span>
            <span class="settings-nav-sub">Période appliquée au chargement</span>
          </div>
        </button>

        <button class="settings-nav-item" data-section="refresh">
          <span class="settings-nav-icon material-symbols-rounded">refresh</span>
          <div class="settings-nav-text">
            <span class="settings-nav-label">Rafraîchissement</span>
            <span class="settings-nav-sub">Fréquence de mise à jour</span>
          </div>
        </button>

        <button class="settings-nav-item" data-section="logs">
          <span class="settings-nav-icon material-symbols-rounded">list_alt</span>
          <div class="settings-nav-text">
            <span class="settings-nav-label">Logs</span>
            <span class="settings-nav-sub">Historique des opérations</span>
          </div>
        </button>

        <button class="settings-nav-item" data-section="purge">
          <span class="settings-nav-icon material-symbols-rounded">delete_forever</span>
          <div class="settings-nav-text">
            <span class="settings-nav-label">Base de données</span>
            <span class="settings-nav-sub">Durée de conservation des données</span>
          </div>
        </button>
      </nav>

      <div class="settings-content">
        <section class="settings-section active" data-section="theme">
          <h3 class="settings-section-title">Thème</h3>
          <p class="settings-section-desc">
            Choisissez comment l’interface s’adapte au mode clair/sombre.
          </p>

          <div class="settings-row">
            <div class="settings-row-main">
              <span class="settings-icon material-symbols-rounded">dark_mode</span>
              <div class="settings-text">
                <label for="theme-select" class="settings-label">Thème</label>
                <div class="settings-subtitle">Choisir l'apparence de l'interface</div>
              </div>
            </div>
            <div class="settings-center">
              <select id="theme-select" class="pill-select">
                <option value="system">Système</option>
                <option value="light">Clair</option>
                <option value="dark">Sombre</option>
              </select>
            </div>
          </div>

          <div class="settings-row">
            <div class="settings-row-main">
              <span class="settings-icon material-symbols-rounded">view_agenda</span>
              <div class="settings-text">
                <label for="card-size-select" class="settings-label">Affichage</label>
                <div class="settings-subtitle">
                  Ajuster la densité d'affichage des résultats
                </div>
              </div>
            </div>
            <div class="settings-center">
              <select id="card-size-select" class="pill-select">
                <option value="compact">Compact</option>
                <option value="normal" selected>Normal</option>
                <option value="large">Large</option>
              </select>
            </div>
          </div>
        </section>

        <section class="settings-section" data-section="sort">
          <h3 class="settings-section-title">Tri par défaut</h3>
          <p class="settings-section-desc">
            Définit l’ordre utilisé automatiquement au chargement du flux.
          </p>

          <div class="settings-row">
            <div class="settings-row-main">
              <span class="settings-icon material-symbols-rounded">sort</span>
              <div class="settings-text">
                <label for="default-sort-select" class="settings-label">Tri par défaut</label>
                <div class="settings-subtitle">Ordre appliqué au chargement du flux</div>
              </div>
            </div>
            <div class="settings-center">
              <select id="default-sort-select" class="pill-select">
                <option value="seeders">Seeders</option>
                <option value="date">Date d'ajout</option>
                <option value="name">Nom</option>
              </select>
            </div>
          </div>
        </section>

        <section class="settings-section" data-section="date">
          <h3 class="settings-section-title">Filtre par défaut</h3>
          <p class="settings-section-desc">
            Limite les résultats aux X derniers jours dès le chargement.
          </p>

          <div class="settings-row">
            <div class="settings-row-main">
              <div class="settings-icon">
                <span class="material-symbols-rounded">schedule</span>
              </div>
              <div class="settings-text">
                <div class="settings-label">Filtre par défaut</div>
                <div class="settings-subtitle">
                  Période appliquée automatiquement au chargement.
                </div>
              </div>
            </div>

            <div class="settings-center">
              <select id="default-date-filter-select" class="pill-select">
                <option value="0">Tout</option>
                <option value="1">24h</option>
                <option value="2">48h</option>
                <option value="3">3 jours</option>
                <option value="7">7 jours</option>
              </select>
            </div>
          </div>
        </section>

        <section class="settings-section" data-section="refresh">
          <h3 class="settings-section-title">Rafraîchissement</h3>
          <p class="settings-section-desc">
            Détermine la fréquence de mise à jour automatique du flux.
          </p>

          <div class="settings-row">
            <div class="settings-row-main">
              <span class="settings-icon material-symbols-rounded">refresh</span>
              <div class="settings-text">
                <label for="refresh-interval-select" class="settings-label">
                  Mode de rafraîchissement
                </label>
                <div class="settings-subtitle">
                  Choisissez entre manuel ou un intervalle automatique.
                </div>
              </div>
            </div>

            <div class="settings-center">
              <select id="refresh-interval-select" class="pill-select">
                <option value="manual">Manuel</option>
                <option value="15">15 min</option>
                <option value="30">30 min</option>
                <option value="60">1 h</option>
              </select>
            </div>
          </div>
          <div class="last-sync-row">
            <span class="last-sync-label">Date de la dernière synchronisation :</span>
            <span id="last-sync-value" class="last-sync-date">inconnue</span>
          </div>
        </section>

        <section class="settings-section" data-section="logs">
          <h3 class="settings-section-title">Logs</h3>
          <p class="settings-section-desc">
            Consulter l’historique détaillé des opérations de synchronisation.
          </p>

          <div class="settings-row">
            <div class="settings-row-main">
              <span class="settings-icon material-symbols-rounded">list_alt</span>
              <div class="settings-text">
                <span class="settings-label">Logs</span>
                <div class="settings-subtitle">Consulter l'historique des opérations</div>
              </div>
            </div>
            <div class="settings-center">
              <button id="open-logs" class="btn-logs">Afficher les logs</button>
            </div>
          </div>
        </section>

        <section class="settings-section" data-section="purge">
          <h3 class="settings-section-title">Purge &amp; rétention</h3>
          <p class="settings-section-desc">
            Choisissez combien de jours les éléments sont conservés en base avant d’être automatiquement supprimés.
          </p>

          <p class="settings-warning" style="color:#ef4444; margin-top: 8px; font-size: 13px">
            ⚠️ Réduire la durée de rétention peut supprimer immédiatement des éléments plus anciens.
          </p>

          <div class="settings-row">
            <div class="settings-row-main">
              <span class="settings-icon material-symbols-rounded">delete_forever</span>
              <div class="settings-text">
                <label for="retention-days-select" class="settings-label">
                  Durée de rétention
                </label>
                <div class="settings-subtitle">
                  Les éléments plus anciens seront définitivement supprimés.
                </div>
              </div>
            </div>
            <div class="settings-center">
              <select id="retention-days-select" class="pill-select">
                <option value="2">2 jours</option>
                <option value="3">3 jours</option>
                <option value="7">7 jours</option>
                <option value="14">14 jours</option>
                <option value="30">30 jours</option>
              </select>
            </div>
          </div>

          <div class="settings-row settings-row-danger">
            <div class="settings-row-main">
              <span class="settings-icon settings-icon-danger material-symbols-rounded">
                image_not_supported
              </span>
              <div class="settings-text">
                <span class="settings-label">Nettoyage des affiches</span>
                <div class="settings-subtitle">
                  Supprime les fichiers d'affiches qui ne sont plus liés à aucun élément.
                </div>
              </div>
            </div>
            <div class="settings-center">
              <button id="cleanup-posters-btn" class="btn-clean-posters">
                Nettoyer
              </button>
            </div>
          </div>

          <div class="settings-row">
            <div class="settings-row-main">
              <span class="settings-icon material-symbols-rounded">monitoring</span>
              <div class="settings-text">
                <span class="settings-label">Statistiques</span>
                <div class="settings-subtitle">
                  Visualiser l’évolution de la base et des affiches.
                </div>
              </div>
            </div>
            <div class="settings-center">
              <button id="open-stats" class="btn-logs">
                Afficher
              </button>
            </div>
          </div>

          <div class="settings-row posters-row">
            <div class="settings-row-main">
              <span class="settings-icon material-symbols-rounded">photo_library</span>
              <div class="settings-text">
                <span class="settings-label">Affiches en cache</span>
                <div class="settings-subtitle">
                  Nombre de fichiers d'affiches présents en local.
                </div>
              </div>
            </div>
            <div class="settings-center">
              <span id="posters-count" class="settings-label posters-count">—</span>
            </div>
          </div>

          <p id="cleanup-posters-status" class="settings-hint"></p>
        </section>

      </div>
    </div>

    <div class="settings-footer">
      <button id="close-settings" class="btn-close">Fermer</button>
    </div>
  </div>

  <div id="logs-overlay" class="settings-overlay hidden"></div>
  <div id="logs-modal" class="settings-modal logs-modal hidden">
    <h2>Logs YGGFeed</h2>

    <div id="logs-content" class="logs-content">
      Chargement des logs…
    </div>

    <div class="settings-footer">
      <button id="close-logs" class="btn-close">Fermer</button>
    </div>
  </div>

  <div id="stats-overlay" class="settings-overlay hidden"></div>
  <div id="stats-modal" class="settings-modal logs-modal hidden">
    <h2>Statistiques</h2>

    <div class="stats-modal-toolbar">
      <div class="stats-metric-group">
        <button class="stats-tab stats-tab-active" data-metric="db-size">
          Taille de la base
        </button>
        <button class="stats-tab" data-metric="posters">
          Pochettes locales
        </button>
        <button class="stats-tab" data-metric="categories">
          Cartes par catégorie
        </button>
        <button class="stats-tab" data-metric="api-calls">
          Appels API
        </button>
      </div>

      <div class="stats-range-toolbar">
        <button
          class="stats-range-tab stats-range-tab-active"
          data-range="live">
          Aujourd’hui
        </button>
        <button class="stats-range-tab" data-range="7">
          7 jours
        </button>
        <button class="stats-range-tab" data-range="30">
          30 jours
        </button>
        <button class="stats-range-tab" data-range="all">
          Tout
        </button>
      </div>
    </div>

    <div class="stats-chart-shell">
      <canvas id="stats-chart"></canvas>
    </div>

    <div class="settings-footer">
      <button id="close-stats" class="btn-close">Fermer</button>
    </div>
  </div>

  <div id="details-overlay" class="settings-overlay hidden"></div>
  <div id="details-modal" class="settings-modal details-modal hidden">
    <div class="details-layout">
      <div class="details-poster-shell">
        <img id="details-poster" class="details-poster" alt="Affiche" />
        <div id="details-poster-fallback" class="details-poster-fallback hidden">
          Affiche
        </div>
      </div>

      <div class="details-content">
        <div class="details-title-row">
          <h2 id="details-title" class="details-title"></h2>
          <button
            id="details-original-toggle"
            class="details-original-toggle hidden"
            type="button"
            title="Afficher le titre original"
          >
            <span class="material-symbols-rounded">info</span>
          </button>
        </div>

        <div id="details-meta" class="details-meta"></div>

        <div class="details-scroll">
          <p id="details-plot" class="details-plot"></p>
          <div id="details-extra" class="details-extra"></div>

          <a
            id="details-imdb-link"
            class="details-imdb-link hidden"
            href="#"
            target="_blank"
            rel="noopener noreferrer"
          >
            Voir la fiche sur IMDb
          </a>
        </div>
      </div>

    </div>

    <div class="settings-footer details-footer">
      <button id="details-close" class="btn-close">Fermer</button>
    </div>
  </div>

  <div id="edit-overlay" class="edit-overlay hidden">
    <div id="edit-modal" class="edit-modal">
      <h2 class="edit-modal-title">Modifier le titre</h2>

      <div class="edit-modal-body">
        <!-- 1. Titre original en premier -->
        <div class="edit-field">
          <div class="edit-label">Titre original</div>
          <div id="edit-original-title" class="edit-original"></div>
        </div>

        <!-- 2. Titre affiché / modifiable -->
        <div class="edit-field">
          <label class="edit-label" for="edit-title-input">Titre affiché</label>
          <input
            id="edit-title-input"
            type="text"
            class="edit-input"
          />
        </div>
      </div>

      <div class="edit-modal-footer">
        <button id="edit-cancel-btn" class="btn btn-secondary">
          Annuler
        </button>
        <button id="edit-save-btn" class="btn btn-primary">
          Enregistrer
        </button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="script.js"></script>
</body>
</html>
